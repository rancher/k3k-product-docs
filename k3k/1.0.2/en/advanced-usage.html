<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Advanced Usage :: K3k</title>
    <link rel="prev" href="architecture.html">
    <link rel="next" href="virtualclusterpolicy.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../_/css/vendor/light.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a class=" navbar-logo" href="https://docs.k3k.io/" aria-label="K3k Documentation Home"><img class="logo"
            src="../../../_/img/logo-horizontal-positive-k3k.svg" alt="K3k logo"/></a>
      </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:k3k" checked> Only this project
          </label>
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">
            <img src="../../../_/img/resources.png" class="langIcon Resources" alt="Resources" title="Resources">
          </div>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/rancher/k3k-product-docs"><i class="fab fa-github"></i>&nbsp;K3k</a>
            <a class="navbar-item" href="https://github.com/rancher/k3k-product-docs/issues"><i class="fab fa-github"></i>&nbsp;GitHub Issue</a>
            <!-- <div class="has-submenu">
              <a class="navbar-item" href="#" ><i class="fas fa-file-alt"></i>&nbsp;Report Issue &nbsp;<i class="fas fa-chevron-right"></i></a>
              <div class="submenu">
                <a class="navbar-item" href="https://scc.suse.com">SCC (Recommended)</a>
                <a class="navbar-item" href="https://github.com/rancher/k3k-product-docs/issues">GitHub Issue</a>
              </div>
            </div> -->
            <a class="navbar-item" href="https://github.com/rancher/k3k/blob/main/docs/development.md"><i class="fas fa-user-edit"></i>&nbsp;Contribute</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link"><img src="../../../_/img/language.png" class="langIcon Language" alt="Language"
              title="Language"></div>
          <div class="navbar-dropdown">
            <!--  </div><div>Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div> -->
              <a role="button" class="navbar-item" id="en" onclick="selectLanguage(this.id)">
                <!--<img src="../../../_/img/engFlag.svg" class="langIcon english">-->
                &nbsp;English
              </a>
            <!-- LANGUAGESELECTOR -->
          </div>
        </div>
        <!--
        <div class="navbar-item">
          <a href="https://twitter.com/SUSE">
            <img alt="X-logo" class="x-logo" src="../../../_/img/x-logo-white.png">
          </a>
        </div>
        -->
      </div>
    </div>

    <!--   <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">

        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
      </div> -->
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="k3k" data-version="1.0.2">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="introduction.html">K3k</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="quickstart.html">Quick Start</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="advanced-usage.html">Advanced Usage</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="virtualclusterpolicy.html">VirtualClusterPolicy: Concepts</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">How-tos for User</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-user/create-virtual-clusters.html">Creating a Virtual Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-user/expose-workloads.html">Exposing workloads outside a Virtual Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-user/addons.html">Addons</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">How-tos for Admin</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-admin/choose-mode.html">Choosing between Shared and Virtual Mode</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-admin/adding-custom-cert.html">Adding custom certificates for K3s from K3k cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="references/crds.html">Customer Resource Definitions (CRDs)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="references/k3kcli.html">k3kcli</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="how-tos-for-user/troubleshooting.html">Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">K3k</span>
    <span class="version">v1.0.2-latest</span>
  </div>
  <ul class="components">
        <li class="component is-current">
          <div class="title"><a href="introduction.html">K3k</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="introduction.html">v1.0.2-latest</a>
            </li>
            <li class="version">
              <a href="../../v1.0.1/en/introduction.html">v1.0.1</a>
            </li>
            <li class="version">
              <a href="../../v1.0.0/en/introduction.html">v1.0.0</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../v1.0.1/en/introduction.html" aria-label="Home" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="introduction.html">K3k</a></li>
    <li><a href="advanced-usage.html">Advanced Usage</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">v1.0.2-latest</button>
  <div class="version-menu">
    <a class="version is-current" href="advanced-usage.html">v1.0.2-latest</a>
    <a class="version" href="../../v1.0.1/en/advanced-usage.html">v1.0.1</a>
    <a class="version" href="../../v1.0.0/en/advanced-usage.html">v1.0.0</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/k3k-product-docs/edit/main/versions/v1.0.2/modules/en/pages/advanced-usage.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Advanced Usage</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document provides advanced usage information for k3k, including detailed use cases and explanations of the <code>Cluster</code> resource fields for customization.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_the_cluster_resource"><a class="anchor" href="#_customizing_the_cluster_resource"></a>Customizing the Cluster Resource</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>Cluster</code> resource provides a variety of fields for customizing the behavior of your virtual clusters. See <a href="references/crds.html" class="xref page">CRD documentation</a> for the full specifications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Most of these customization options can also be configured using the <code>k3kcli</code> tool. Refer to <a href="references/k3kcli.html" class="xref page">k3kcli documentation</a> for more details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example creates a "shared" mode K3k cluster with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>3 servers</p>
</li>
<li>
<p>K3s version v1.31.3-k3s1</p>
</li>
<li>
<p>Custom network configuration</p>
</li>
<li>
<p>Deployment on specific nodes with the <code>nodeSelector</code></p>
</li>
<li>
<p><code>kube-api</code> exposed using an ingress</p>
</li>
<li>
<p>Custom K3s <code>serverArgs</code></p>
</li>
<li>
<p>ETCD data persisted using a <code>PVC</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: k3k.io/v1beta1
kind: Cluster
metadata:
  name: my-virtual-cluster
  namespace: my-namespace
spec:
  mode: shared
  version: v1.31.3-k3s1
  servers: 3
  tlsSANs:
    - my-cluster.example.com
  nodeSelector:
    disktype: ssd
  expose:
    ingress:
      ingressClassName: nginx
      annotations:
        nginx.ingress.kubernetes.io/ssl-passthrough: "true"
        nginx.ingress.kubernetes.io/backend-protocol: "true"
        nginx.ingress.kubernetes.io/ssl-redirect: "HTTPS"
  clusterCIDR: 10.42.0.0/16
  serviceCIDR: 10.43.0.0/16
  clusterDNS: 10.43.0.10
  serverArgs:
  - --tls-san=my-cluster.example.com
  persistence:
    type: dynamic
    storageClassName: local-path</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_mode"><a class="anchor" href="#_mode"></a><code>mode</code></h3>
<div class="paragraph">
<p>The <code>mode</code> field specifies the cluster provisioning mode, which can be either <code>shared</code> or <code>virtual</code>. The default mode is <code>shared</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>shared</code> mode:</strong> In this mode, the virtual cluster shares the host cluster&#8217;s resources and networking. This mode is suitable for lightweight workloads and development environments where isolation is not a primary concern.</p>
</li>
<li>
<p><strong><code>virtual</code> mode:</strong> In this mode, the virtual cluster runs as a separate K3s cluster within the host cluster. This mode provides stronger isolation and is suitable for production workloads or when dedicated resources are required.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_version"><a class="anchor" href="#_version"></a><code>version</code></h3>
<div class="paragraph">
<p>The <code>version</code> field specifies the Kubernetes version to be used by the virtual nodes. If not specified, K3k will use the same K3s version as the host cluster. For example, if the host cluster is running Kubernetes v1.31.3, K3k will use the corresponding K3s version (e.g., <code>v1.31.3-k3s1</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_servers"><a class="anchor" href="#_servers"></a><code>servers</code></h3>
<div class="paragraph">
<p>The <code>servers</code> field specifies the number of K3s server nodes to deploy for the virtual cluster. The default value is 1.</p>
</div>
</div>
<div class="sect2">
<h3 id="_agents"><a class="anchor" href="#_agents"></a><code>agents</code></h3>
<div class="paragraph">
<p>The <code>agents</code> field specifies the number of K3s agent nodes to deploy for the virtual cluster. The default value is 0.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In <code>shared</code> mode, this field is ignored, as the Virtual Kubelet acts as the agent, and there are no K3s worker nodes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_nodeselector"><a class="anchor" href="#_nodeselector"></a><code>nodeSelector</code></h3>
<div class="paragraph">
<p>The <code>nodeSelector</code> field allows you to specify a node selector that will be applied to all server/agent pods. In <code>shared</code> mode, the node selector will also be applied to the workloads.</p>
</div>
</div>
<div class="sect2">
<h3 id="_expose"><a class="anchor" href="#_expose"></a><code>expose</code></h3>
<div class="paragraph">
<p>The <code>expose</code> field contains options for exposing the API server of the virtual cluster. By default, the API server is only exposed as a <code>ClusterIP</code>, which is relatively secure but difficult to access from outside the cluster.</p>
</div>
<div class="paragraph">
<p>You can use the <code>expose</code> field to enable exposure via <code>NodePort</code>, <code>LoadBalancer</code>, or <code>Ingress</code>.</p>
</div>
<div class="paragraph">
<p>In this example we are exposing the Cluster with a Nginx ingress-controller, that has to be configured with the <code>--enable-ssl-passthrough</code> flag.</p>
</div>
</div>
<div class="sect2">
<h3 id="_clustercidr"><a class="anchor" href="#_clustercidr"></a><code>clusterCIDR</code></h3>
<div class="paragraph">
<p>The <code>clusterCIDR</code> field specifies the CIDR range for the pods of the cluster. The default value is <code>10.42.0.0/16</code> in shared mode, and <code>10.52.0.0/16</code> in virtual mode.</p>
</div>
</div>
<div class="sect2">
<h3 id="_servicecidr"><a class="anchor" href="#_servicecidr"></a><code>serviceCIDR</code></h3>
<div class="paragraph">
<p>The <code>serviceCIDR</code> field specifies the CIDR range for the services in the cluster. The default value is <code>10.43.0.0/16</code> in shared mode, and <code>10.53.0.0/16</code> in virtual mode.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In <code>shared</code> mode, the <code>serviceCIDR</code> should match the host cluster&#8217;s <code>serviceCIDR</code> to prevent conflicts and in <code>virtual</code> mode both <code>serviceCIDR</code> and <code>clusterCIDR</code> should be different than the host cluster.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_clusterdns"><a class="anchor" href="#_clusterdns"></a><code>clusterDNS</code></h3>
<div class="paragraph">
<p>The <code>clusterDNS</code> field specifies the IP address for the CoreDNS service. It needs to be in the range provided by <code>serviceCIDR</code>. The default value is <code>10.43.0.10</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_serverargs"><a class="anchor" href="#_serverargs"></a><code>serverArgs</code></h3>
<div class="paragraph">
<p>The <code>serverArgs</code> field allows you to specify additional arguments to be passed to the K3s server pods.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_cli"><a class="anchor" href="#_using_the_cli"></a>Using the cli</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can check the <a href="references/k3kcli.html" class="xref page">k3kcli documentation</a> for the full specs.</p>
</div>
<div class="sect2">
<h3 id="_no_storage_provider"><a class="anchor" href="#_no_storage_provider"></a>No storage provider:</h3>
<div class="ulist">
<ul>
<li>
<p>Ephemeral Storage:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">  k3kcli cluster create --persistence-type ephemeral my-cluster</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Using <code>--persistence-type ephemeral</code> will result in data loss if the nodes are restarted.</p>
</li>
<li>
<p>It is highly recommended to use <code>--persistence-type dynamic</code> with a configured storage class.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="architecture.html">Architecture</a></span>
  <span class="next"><a href="virtualclusterpolicy.html">VirtualClusterPolicy: Concepts</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
<script src="../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../_/js/vendor/tabs.js"></script>


  </body>
</html>
