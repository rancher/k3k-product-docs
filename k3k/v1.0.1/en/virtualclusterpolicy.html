<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VirtualClusterPolicy: Concepts :: K3k</title>
    <link rel="prev" href="advanced-usage.html">
    <link rel="next" href="how-tos-for-user/create-virtual-clusters.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../_/css/vendor/light.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script><header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a class=" navbar-logo" href="https://docs.k3k.io/" aria-label="K3k Documentation Home"><img class="logo"
            src="../../../_/img/logo-horizontal-positive-k3k.svg" alt="K3k logo"/></a>
      </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:k3k" checked> Only this project
          </label>
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">
            <img src="../../../_/img/resources.png" class="langIcon Resources" alt="Resources" title="Resources">
          </div>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/rancher/k3k-product-docs"><i class="fab fa-github"></i>&nbsp;K3k</a>
            <a class="navbar-item" href="https://github.com/rancher/k3k-product-docs/issues"><i class="fab fa-github"></i>&nbsp;GitHub Issue</a>
            <!-- <div class="has-submenu">
              <a class="navbar-item" href="#" ><i class="fas fa-file-alt"></i>&nbsp;Report Issue &nbsp;<i class="fas fa-chevron-right"></i></a>
              <div class="submenu">
                <a class="navbar-item" href="https://scc.suse.com">SCC (Recommended)</a>
                <a class="navbar-item" href="https://github.com/rancher/k3k-product-docs/issues">GitHub Issue</a>
              </div>
            </div> -->
            <a class="navbar-item" href="https://github.com/rancher/k3k/blob/main/docs/development.md"><i class="fas fa-user-edit"></i>&nbsp;Contribute</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link"><img src="../../../_/img/language.png" class="langIcon Language" alt="Language"
              title="Language"></div>
          <div class="navbar-dropdown">
            <!--  </div><div>Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div> -->
              <a role="button" class="navbar-item" id="en" onclick="selectLanguage(this.id)">
                <!--<img src="../../../_/img/engFlag.svg" class="langIcon english">-->
                &nbsp;English
              </a>
            <!-- LANGUAGESELECTOR -->
          </div>
        </div>
        <!--
        <div class="navbar-item">
          <a href="https://twitter.com/SUSE">
            <img alt="X-logo" class="x-logo" src="../../../_/img/x-logo-white.png">
          </a>
        </div>
        -->
      </div>
    </div>

    <!--   <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">

        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
        <div class="navbar-item">
          <span class="control">
          </span>
        </div>
      </div> -->
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="k3k" data-version="v1.0.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="introduction.html">K3k</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="quickstart.html">Quick Start</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="advanced-usage.html">Advanced Usage</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="virtualclusterpolicy.html">VirtualClusterPolicy: Concepts</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">How-tos for User</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-user/create-virtual-clusters.html">Creating a Virtual Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-user/expose-workloads.html">Exposing workloads outside a Virtual Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-user/addons.html">Addons</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">How-tos for Admin</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-admin/choose-mode.html">Choosing between Shared and Virtual Mode</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="how-tos-for-admin/adding-custom-cert.html">Adding custom certificates for K3s from K3k cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="references/crds.html">Customer Resource Definitions (CRDs)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="references/k3kcli.html">k3kcli</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="how-tos-for-user/troubleshooting.html">Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">K3k</span>
    <span class="version">v1.0.1</span>
  </div>
  <ul class="components">
        <li class="component is-current">
          <div class="title"><a href="../../1.0.2/en/introduction.html">K3k</a></div>
          <ul class="versions">
            <li class="version is-latest">
              <a href="../../1.0.2/en/introduction.html">v1.0.2-latest</a>
            </li>
            <li class="version is-current">
              <a href="introduction.html">v1.0.1</a>
            </li>
            <li class="version">
              <a href="../../v1.0.0/en/introduction.html">v1.0.0</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="introduction.html" aria-label="Home" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="introduction.html">K3k</a></li>
    <li><a href="virtualclusterpolicy.html">VirtualClusterPolicy: Concepts</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">v1.0.1</button>
  <div class="version-menu">
    <a class="version" href="../../1.0.2/en/virtualclusterpolicy.html">v1.0.2-latest</a>
    <a class="version is-current" href="virtualclusterpolicy.html">v1.0.1</a>
    <a class="version" href="../../v1.0.0/en/virtualclusterpolicy.html">v1.0.0</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/rancher/k3k-product-docs/edit/main/versions/v1.0.1/modules/en/pages/virtualclusterpolicy.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">VirtualClusterPolicy: Concepts</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <code>VirtualClusterPolicy</code> Custom Resource in K3k provides a way to define and enforce consistent configurations, security settings, and resource management rules for your virtual clusters and the Namespaces they operate within.</p>
</div>
<div class="paragraph">
<p>By using VCPs, administrators can centrally manage these aspects, reducing manual configuration, ensuring alignment with organizational standards, and enhancing the overall security and operational consistency of the K3k environment.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Using a combination of <code>RKE2</code> and <code>Cilium</code> in the host cluster could result in issues with network policies. The recommended solution is to use <code>VirtualClusterPolicy</code> to disable network policy setup with K3k.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_core_concepts"><a class="anchor" href="#_core_concepts"></a>Core Concepts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_a_virtualclusterpolicy"><a class="anchor" href="#_what_is_a_virtualclusterpolicy"></a>What is a VirtualClusterPolicy?</h3>
<div class="paragraph">
<p>A <code>VirtualClusterPolicy</code> is a cluster-scoped Kubernetes Custom Resource that specifies a set of rules and configurations. These policies are then applied to K3k virtual clusters (<code>Cluster</code> resources) operating within Kubernetes Namespaces that are explicitly bound to a VCP.</p>
</div>
</div>
<div class="sect2">
<h3 id="_binding_a_policy_to_a_namespace"><a class="anchor" href="#_binding_a_policy_to_a_namespace"></a>Binding a Policy to a Namespace</h3>
<div class="paragraph">
<p>To apply a <code>VirtualClusterPolicy</code> to one or more Namespaces (and thus to all K3k <code>Cluster</code> resources within those Namespaces), you need to label the desired Namespace(s).</p>
</div>
<div class="paragraph">
<p>Add the following label to your Namespace metadata:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>`policy.k3k.io/policy-name: &lt;YOUR_POLICY_NAME&gt;`</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example: Labeling a Namespace</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Namespace
metadata:
  name: my-app-namespace
  labels:
    policy.k3k.io/policy-name: "standard-dev-policy"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>my-app-namespace</code> will adhere to the rules defined in the <code>VirtualClusterPolicy</code> named <code>standard-dev-policy</code>. Multiple Namespaces can be bound to the same policy for uniform configuration, or different Namespaces can be bound to distinct policies.</p>
</div>
<div class="paragraph">
<p>It&#8217;s also important to note what happens when a Namespace&#8217;s policy binding changes. If a Namespace is unbound from a VirtualClusterPolicy (by removing the policy.k3k.io/policy-name label), K3k will clean up and remove the resources (such as ResourceQuotas, LimitRanges, and managed Namespace labels) that were originally applied by that policy. Similarly, if the label is changed to bind the Namespace to a new VirtualClusterPolicy, K3k will first remove the resources associated with the old policy before applying the configurations from the new one, ensuring a clean transition.</p>
</div>
</div>
<div class="sect2">
<h3 id="_default_policy_values"><a class="anchor" href="#_default_policy_values"></a>Default Policy Values</h3>
<div class="paragraph">
<p>If you create a <code>VirtualClusterPolicy</code> without specifying any <code>spec</code> fields (for example, using <code>k3kcli policy create my-default-policy</code>), it will be created with default settings. Currently, this includes <code>spec.allowedMode</code> being set to <code>shared</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># Example of a minimal VCP (after creation with defaults)
apiVersion: k3k.io/v1beta1
kind: VirtualClusterPolicy
metadata:
  name: my-default-policy
spec:
  allowedMode: shared</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_key_capabilities_examples"><a class="anchor" href="#_key_capabilities_examples"></a>Key Capabilities &amp; Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <code>VirtualClusterPolicy</code> can configure several aspects of the Namespaces it&#8217;s bound to and the virtual clusters operating within them.</p>
</div>
<div class="sect2">
<h3 id="_restricting_allowed_virtual_cluster_modes_allowedmode"><a class="anchor" href="#_restricting_allowed_virtual_cluster_modes_allowedmode"></a>Restricting Allowed Virtual Cluster Modes (<code>AllowedMode</code>)</h3>
<div class="paragraph">
<p>You can restrict the <code>mode</code> (e.g., "shared" or "virtual") in which K3k <code>Cluster</code> resources can be provisioned within bound Namespaces. If a <code>Cluster</code> is created in a bound Namespace with a mode not allowed in <code>allowedMode</code>, its creation might proceed but an error should be reported in the <code>Cluster</code> resource&#8217;s status.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong> Allow only "shared" mode clusters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: k3k.io/v1beta1
kind: VirtualClusterPolicy
metadata:
  name: shared-only-policy
spec:
  allowedModeTypes:
  - shared</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify this using the CLI: <code>k3kcli policy create --mode shared shared-only-policy</code> (or <code>--mode virtual</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_defining_resource_quotas_quota"><a class="anchor" href="#_defining_resource_quotas_quota"></a>Defining Resource Quotas (<code>quota</code>)</h3>
<div class="paragraph">
<p>You can define resource consumption limits for bound Namespaces by specifying a <code>ResourceQuota</code>. K3k will create a <code>ResourceQuota</code> object in each bound Namespace with the provided specifications.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong> Set CPU, memory, and pod limits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: k3k.io/v1beta1
kind: VirtualClusterPolicy
metadata:
  name: quota-policy
spec:
  quota:
    hard:
      cpu: "10"
      memory: "20Gi"
      pods: "10"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_limit_ranges_limit"><a class="anchor" href="#_setting_limit_ranges_limit"></a>Setting Limit Ranges (<code>limit</code>)</h3>
<div class="paragraph">
<p>You can define default resource requests/limits and min/max constraints for containers running in bound Namespaces by specifying a <code>LimitRange</code>. K3k will create a <code>LimitRange</code> object in each bound Namespace.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong> Define default CPU requests/limits and min/max CPU.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: k3k.io/v1beta1
kind: VirtualClusterPolicy
metadata:
  name: limit-policy
spec:
  limit:
    limits:
    - default:
        cpu: "500m"
      defaultRequest:
        cpu: "500m"
      max:
        cpu: "1"
      min:
        cpu: "100m"
      type: Container</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_managing_network_isolation_disablenetworkpolicy"><a class="anchor" href="#_managing_network_isolation_disablenetworkpolicy"></a>Managing Network Isolation (<code>disableNetworkPolicy</code>)</h3>
<div class="paragraph">
<p>By default, K3k creates a <code>NetworkPolicy</code> in bound Namespaces to provide network isolation for virtual clusters (especially in shared mode). You can disable the creation of this default policy.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong> Disable the default NetworkPolicy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: k3k.io/v1beta1
kind: VirtualClusterPolicy
metadata:
  name: no-default-netpol-policy
spec:
  disableNetworkPolicy: true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enforcing_pod_security_admission_podsecurityadmissionlevel"><a class="anchor" href="#_enforcing_pod_security_admission_podsecurityadmissionlevel"></a>Enforcing Pod Security Admission (<code>podSecurityAdmissionLevel</code>)</h3>
<div class="paragraph">
<p>You can enforce Pod Security Standards (PSS) by specifying a Pod Security Admission (PSA) level. K3k applies the corresponding PSA labels to each bound Namespace. The allowed values are <code>privileged</code>, <code>baseline</code>, <code>restricted</code>, and this adds labels like <code>pod-security.kubernetes.io/enforce: &lt;level&gt;</code> to the bound Namespace.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong> Enforce the "baseline" PSS level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: k3k.io/v1beta1
kind: VirtualClusterPolicy
metadata:
  name: baseline-psa-policy
spec:
  podSecurityAdmissionLevel: baseline</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_information"><a class="anchor" href="#_additional_information"></a>Additional information</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>For a complete reference of all <code>VirtualClusterPolicy</code> spec fields, see <a href="references/crds.html#VirtualClusterPolicy" class="xref page">API Reference for VirtualClusterPolicy</a>.</p>
</li>
<li>
<p>To understand how VCPs fit into the overall K3k system, see <a href="architecture.html" class="xref page">Architecture</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="advanced-usage.html">Advanced Usage</a></span>
  <span class="next"><a href="how-tos-for-user/create-virtual-clusters.html">Creating a Virtual Cluster</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
<script src="../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../_/js/vendor/tabs.js"></script>


  </body>
</html>
