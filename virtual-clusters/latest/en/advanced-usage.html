<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Advanced Usage :: SUSE® Virtual Clusters</title>
    <link rel="prev" href="development.html">
    <link rel="next" href="virtualclusterpolicy.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-09-16"/>
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script>
<!-- Canonical link -->
<link href="" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/virtual-clusters/latest/en/advanced-usage.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/virtual-clusters/latest/en/advanced-usage.html" hrefLang="en-US" rel="alternate" />











<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a><div class="body">
<div class="nav-container" data-component="virtual-clusters" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">SUSE® Virtual Clusters</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="k3k.html">K3k: Kubernetes in Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="development.html">Development</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="advanced-usage.html">Advanced Usage</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="virtualclusterpolicy.html">VirtualClusterPolicy</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">How-to guides</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="howtos/airgap.html">Installing Virtual Clusters in an air-gapped environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="howtos/choose-mode.html">Choosing between Shared and Virtual Mode</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="howtos/create-virtual-clusters.html">Creating a Virtual Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="howtos/expose-workloads.html">Exposing workloads outside a Virtual Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="howtos/adding-custom-cert.html">Adding custom certificates for k3s from k3k cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="references/crds.html">Customer Resource Definitions (CRDs)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="references/k3kcli.html">k3kcli</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="howtos/troubleshooting.html">Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SUSE® Virtual Clusters</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component is-current">
          <div class="title"><a href="introduction.html">SUSE® Virtual Clusters</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="introduction.html">Latest</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="" title="" aria-label="SUSE Documentation - ">
        
      </a>
    </li>
      <li>
          <a href="advanced-usage.html" title="Advanced Usage" aria-label="Advanced Usage">Advanced Usage</a>
      </li>
  </ul>
</nav>  <div class="edit-this-page"><a href="https://github.com/rancher/k3k-product-docs/edit/main/versions/latest/modules/en/pages/advanced-usage.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:virtual-clusters" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Advanced Usage</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document provides advanced usage information for k3k, including detailed use cases and explanations of the <code>Cluster</code> resource fields for customization.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_the_cluster_resource"><a class="anchor" href="#_customizing_the_cluster_resource"></a>Customizing the Cluster Resource</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>Cluster</code> resource provides a variety of fields for customizing the behavior of your virtual clusters. See <a href="references/crds.html" class="xref page">CRD documentation</a> for the full specifications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Most of these customization options can also be configured using the <code>k3kcli</code> tool. Refer to <a href="references/k3kcli.html" class="xref page">k3kcli documentation</a> for more details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example creates a "shared" mode K3k cluster with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>3 servers</p>
</li>
<li>
<p>K3s version v1.31.3-k3s1</p>
</li>
<li>
<p>Custom network configuration</p>
</li>
<li>
<p>Deployment on specific nodes with the <code>nodeSelector</code></p>
</li>
<li>
<p><code>kube-api</code> exposed using an ingress</p>
</li>
<li>
<p>Custom K3s <code>serverArgs</code></p>
</li>
<li>
<p>ETCD data persisted using a <code>PVC</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: k3k.io/v1alpha1
kind: Cluster
metadata:
  name: my-virtual-cluster
  namespace: my-namespace
spec:
  mode: shared
  version: v1.31.3-k3s1
  servers: 3
  tlsSANs:
    - my-cluster.example.com
  nodeSelector:
    disktype: ssd
  expose:
    ingress:
      ingressClassName: nginx
      annotations:
        nginx.ingress.kubernetes.io/ssl-passthrough: "true"
        nginx.ingress.kubernetes.io/backend-protocol: "true"
        nginx.ingress.kubernetes.io/ssl-redirect: "HTTPS"
  clusterCIDR: 10.42.0.0/16
  serviceCIDR: 10.43.0.0/16
  clusterDNS: 10.43.0.10
  serverArgs:
  - --tls-san=my-cluster.example.com
  persistence:
    type: dynamic
    storageClassName: local-path</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_mode"><a class="anchor" href="#_mode"></a><code>mode</code></h3>
<div class="paragraph">
<p>The <code>mode</code> field specifies the cluster provisioning mode, which can be either <code>shared</code> or <code>virtual</code>. The default mode is <code>shared</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>shared</code> mode:</strong> In this mode, the virtual cluster shares the host cluster&#8217;s resources and networking. This mode is suitable for lightweight workloads and development environments where isolation is not a primary concern.</p>
</li>
<li>
<p><strong><code>virtual</code> mode:</strong> In this mode, the virtual cluster runs as a separate K3s cluster within the host cluster. This mode provides stronger isolation and is suitable for production workloads or when dedicated resources are required.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_version"><a class="anchor" href="#_version"></a><code>version</code></h3>
<div class="paragraph">
<p>The <code>version</code> field specifies the Kubernetes version to be used by the virtual nodes. If not specified, K3k will use the same K3s version as the host cluster. For example, if the host cluster is running Kubernetes v1.31.3, K3k will use the corresponding K3s version (e.g., <code>v1.31.3-k3s1</code>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_servers"><a class="anchor" href="#_servers"></a><code>servers</code></h3>
<div class="paragraph">
<p>The <code>servers</code> field specifies the number of K3s server nodes to deploy for the virtual cluster. The default value is 1.</p>
</div>
</div>
<div class="sect2">
<h3 id="_agents"><a class="anchor" href="#_agents"></a><code>agents</code></h3>
<div class="paragraph">
<p>The <code>agents</code> field specifies the number of K3s agent nodes to deploy for the virtual cluster. The default value is 0.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In <code>shared</code> mode, this field is ignored, as the Virtual Kubelet acts as the agent, and there are no K3s worker nodes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_nodeselector"><a class="anchor" href="#_nodeselector"></a><code>nodeSelector</code></h3>
<div class="paragraph">
<p>The <code>nodeSelector</code> field allows you to specify a node selector that will be applied to all server/agent pods. In <code>shared</code> mode, the node selector will also be applied to the workloads.</p>
</div>
</div>
<div class="sect2">
<h3 id="_expose"><a class="anchor" href="#_expose"></a><code>expose</code></h3>
<div class="paragraph">
<p>The <code>expose</code> field contains options for exposing the API server of the virtual cluster. By default, the API server is only exposed as a <code>ClusterIP</code>, which is relatively secure but difficult to access from outside the cluster.</p>
</div>
<div class="paragraph">
<p>You can use the <code>expose</code> field to enable exposure via <code>NodePort</code>, <code>LoadBalancer</code>, or <code>Ingress</code>.</p>
</div>
<div class="paragraph">
<p>In this example we are exposing the Cluster with a Nginx ingress-controller, that has to be configured with the <code>--enable-ssl-passthrough</code> flag.</p>
</div>
</div>
<div class="sect2">
<h3 id="_clustercidr"><a class="anchor" href="#_clustercidr"></a><code>clusterCIDR</code></h3>
<div class="paragraph">
<p>The <code>clusterCIDR</code> field specifies the CIDR range for the pods of the cluster. The default value is <code>10.42.0.0/16</code> in shared mode, and <code>10.52.0.0/16</code> in virtual mode.</p>
</div>
</div>
<div class="sect2">
<h3 id="_servicecidr"><a class="anchor" href="#_servicecidr"></a><code>serviceCIDR</code></h3>
<div class="paragraph">
<p>The <code>serviceCIDR</code> field specifies the CIDR range for the services in the cluster. The default value is <code>10.43.0.0/16</code> in shared mode, and <code>10.53.0.0/16</code> in virtual mode.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In <code>shared</code> mode, the <code>serviceCIDR</code> should match the host cluster&#8217;s <code>serviceCIDR</code> to prevent conflicts and in <code>virtual</code> mode both <code>serviceCIDR</code> and <code>clusterCIDR</code> should be different than the host cluster.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_clusterdns"><a class="anchor" href="#_clusterdns"></a><code>clusterDNS</code></h3>
<div class="paragraph">
<p>The <code>clusterDNS</code> field specifies the IP address for the CoreDNS service. It needs to be in the range provided by <code>serviceCIDR</code>. The default value is <code>10.43.0.10</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_serverargs"><a class="anchor" href="#_serverargs"></a><code>serverArgs</code></h3>
<div class="paragraph">
<p>The <code>serverArgs</code> field allows you to specify additional arguments to be passed to the K3s server pods.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_cli"><a class="anchor" href="#_using_the_cli"></a>Using the cli</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can check the <a href="references/k3kcli.html" class="xref page">k3kcli documentation</a> for the full specs.</p>
</div>
<div class="sect2">
<h3 id="_no_storage_provider"><a class="anchor" href="#_no_storage_provider"></a>No storage provider:</h3>
<div class="ulist">
<ul>
<li>
<p>Ephemeral Storage:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">  k3kcli cluster create --persistence-type ephemeral my-cluster</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Using <code>--persistence-type ephemeral</code> will result in data loss if the nodes are restarted.</p>
</li>
<li>
<p>It is highly recommended to use <code>--persistence-type dynamic</code> with a configured storage class.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="development.html">Development</a></span>
  <span class="next"><a href="virtualclusterpolicy.html">VirtualClusterPolicy</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
<script src="../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../_/js/vendor/tabs.js"></script>


<script src="../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
