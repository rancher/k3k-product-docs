<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>K3k: Kubernetes in Kubernetes :: SUSE® Virtual Clusters</title>
    <link rel="prev" href="introduction.html">
    <link rel="next" href="architecture.html">
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../../_/css/site.css">
<meta http-equiv="last-modified" content="2025-10-06"/>
<link rel="stylesheet" href="../../../_/css/search.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../../_/css/font-styles.css">
<link rel="stylesheet" href="../../../_/fonts/css/all.css">
<link rel="stylesheet" href="../../../_/css/site-extra.css">
<link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap&family=SUSE+Mono:ital,wght@0,100..800;1,100..800" rel="stylesheet">
<link href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap" rel="stylesheet"> -->
<link rel="stylesheet" href="../../../_/css/vendor/light.css">
<script src="/docserv/res/lightheaded/analytics.js" type="text/javascript"></script>

<script type="module">
  import { defineCustomElements, setAssetPath } from 'https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/shared-header.esm.js';
  defineCustomElements();
  setAssetPath("https://d12w0ryu9hjsx8.cloudfront.net/shared-header/1.5/assets");
</script>    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; mermaid.initialize({"startOnLoad":true});</script>
<!-- Canonical link -->
<link href="" rel="canonical"/>

<!-- Default English link -->
<link href="https://documentation.suse.com/cloudnative/virtual-clusters/latest/en/k3k.html" hreflang="x-default" rel="alternate"/>

<!-- Link for the currently processed page -->
<link href="https://documentation.suse.com/cloudnative/virtual-clusters/latest/en/k3k.html" hrefLang="en-US" rel="alternate" />











<shared-header language="en" languages='{
"en": { "label": "English", "url": "https://documentation.suse.com/en-us/" },
"de": { "label": "Deutsch", "url": "https://documentation.suse.com/de-de/" },
"fr": { "label": "Français", "url": "https://documentation.suse.com/fr-fr/" },
"es": { "label": "Español", "url": "https://documentation.suse.com/es-es/" },
"zh_CN": { "label": "中文", "url": "https://documentation.suse.com/zh-cn/" },
"pt_BR": { "label": "Português Brasileiro", "url": "https://documentation.suse.com/pt-br/" }
}'>
</shared-header>
<a target=_blank"" class="survey-link" href="https://suselinux.fra1.qualtrics.com/jfe/form/SV_bEiGZbUNzLD8Tcy"> Documentation survey </a><div class="body">
<div class="nav-container" data-component="virtual-clusters" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title">SUSE® Virtual Clusters</h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="k3k.html">K3k: Kubernetes in Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="architecture.html">Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="development.html">Development</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="advanced-usage.html">Advanced Usage</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="virtualclusterpolicy.html">VirtualClusterPolicy</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">How-to guides</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="howtos/airgap.html">Installing Virtual Clusters in an air-gapped environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="howtos/choose-mode.html">Choosing between Shared and Virtual Mode</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="howtos/create-virtual-clusters.html">Creating a Virtual Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="howtos/expose-workloads.html">Exposing workloads outside a Virtual Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="howtos/adding-custom-cert.html">Adding custom certificates for k3s from k3k cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle" aria-label="Toggle expand/collapse"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="references/crds.html">Customer Resource Definitions (CRDs)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="references/k3kcli.html">k3kcli</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="howtos/troubleshooting.html">Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SUSE® Virtual Clusters</span>
    <span class="version">Latest</span>
  </div>
  <ul class="components">
        <li class="component is-current">
          <div class="title"><a href="introduction.html">SUSE® Virtual Clusters</a></div>
          <ul class="versions">
            <li class="version is-current is-latest">
              <a href="introduction.html">Latest</a>
            </li>
          </ul>
        </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
<ul>
    <li>
      <a href="https://documentation.suse.com/" title="documentation.suse.com" aria-label="SUSE Documentation Home">Documentation Home</a>
    </li>
    <li>
      <a href="" title="" aria-label="SUSE Documentation - ">
        
      </a>
    </li>
      <li>
          <a href="k3k.html" title="K3k: Kubernetes in Kubernetes" aria-label="K3k: Kubernetes in Kubernetes">K3k: Kubernetes in Kubernetes</a>
      </li>
  </ul>
</nav>  <div class="edit-this-page"><a href="https://github.com/rancher/k3k-product-docs/edit/main/versions/latest/modules/en/pages/k3k.adoc"><strong>Edit</strong></a></div>
        <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label class="visual-search-label-bc" for="search-input">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
          <input label="Search" aria-label="Search" id="search-input" type="text" placeholder="Search the docs" >
          <label class="filter checkbox" style="display: none">
            <input type="checkbox" data-facet-filter="component:virtual-clusters" checked> Only this project
          </label>
        </div>
      </div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="On this page" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">K3k: Kubernetes in Kubernetes</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>K3k, Kubernetes in Kubernetes, is a tool that enables you to create and manage isolated K3s clusters within your existing Kubernetes environment. It enables multi-tenancy, experimentation, and resource isolation, reducing infrastructure costs by allowing you to run multiple lightweight Kubernetes clusters on the same physical host. K3k offers both "shared" mode, optimizing resource utilization, and "virtual" mode, providing complete isolation with dedicated K3s server pods. This allows you to access a full Kubernetes experience without the overhead of managing separate physical resources.</p>
</div>
<div class="paragraph">
<p>K3k integrates with Rancher for simplified management of your embedded clusters.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_features_and_benefits"><a class="anchor" href="#_features_and_benefits"></a>Features and Benefits</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Resource Isolation</strong>: Enables workload isolation and prevents resource contention between teams or applications. K3k allows you to define resource limits and quotas for each embedded cluster, so that one team&#8217;s workloads won&#8217;t impact another&#8217;s performance.</p>
</li>
<li>
<p><strong>Simplified Multi-Tenancy</strong>: Create dedicated Kubernetes environments for different users or projects, simplifying access control and management. Provide each team with its own cluster, complete with its own namespaces, RBAC, and resource quotas, without the complexity of managing multiple physical clusters.</p>
</li>
<li>
<p><strong>Lightweight and Fast</strong>: K3s spins up and tears down clusters quickly, accelerating development and testing cycles. Spin up a new K3k cluster in seconds, test your application in a clean environment, and tear it down just as quickly, streamlining your CI/CD pipeline.</p>
</li>
<li>
<p><strong>Optimize Resource Utilization (Shared Mode)</strong>: Efficiently use your infrastructure by running multiple K3s clusters on the same physical host. K3k&#8217;s shared mode allows efficient sharing of resources.</p>
</li>
<li>
<p><strong>Complete Isolation (Virtual Mode)</strong>: K3k’s virtual mode provides dedicated K3s server pods for each cluster. This ensures separation of workloads, reducing resource contention and security risks.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Virtual Mode can allow privilege escalation and hence, you need to take caution while running in Virtual Mode.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation"><a class="anchor" href="#_installation"></a>Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides instructions on how to install K3k and the k3kcli.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://helm.sh/">Helm</a> must be installed to use the charts. Please refer to <a href="https://helm.sh/docs/">Helm&#8217;s documentation</a> to get started.</p>
</li>
<li>
<p>An existing <a href="https://documentation.suse.com/cloudnative/rke2/latest/en/install/quickstart.html">RKE2</a> Kubernetes cluster (recommended).</p>
</li>
<li>
<p>A configured storage provider with a default storage class.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you do not have a storage provider, you can configure the cluster to use ephemeral or static storage. Please consult the <a href="advanced-usage.html#_using_the_cli" class="xref page">k3kcli Advanced Usage</a> for instructions on using these options.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_install_the_k3k_controller"><a class="anchor" href="#_install_the_k3k_controller"></a>Install the K3k controller</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the K3k Helm repository:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">helm repo add k3k https://rancher.github.io/k3k
helm repo update</code></pre>
</div>
</div>
</li>
<li>
<p>Install the K3k controller:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">helm install --namespace k3k-system --create-namespace k3k k3k/k3k</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_install_the_k3kcli"><a class="anchor" href="#_install_the_k3kcli"></a>Install the <code>k3kcli</code></h3>
<div class="paragraph">
<p>The <code>k3kcli</code> provides a quick and easy way to create K3k clusters and automatically exposes them via a kubeconfig.</p>
</div>
<div class="paragraph">
<p>To install it, simply download the latest available version for your architecture from the GitHub Releases page.</p>
</div>
<div class="paragraph">
<p>For example, you can download the Linux amd64 version with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">wget -qO k3kcli https://github.com/rancher/k3k/releases/download/{latest-version}/k3kcli-linux-amd64 &amp;&amp; \
  chmod +x k3kcli &amp;&amp; \
  sudo mv k3kcli /usr/local/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">-&gt; % k3kcli --version
k3kcli version v0.3.4</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage"><a class="anchor" href="#_usage"></a>Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides examples of how to use the <code>k3kcli</code> to manage your K3k clusters.</p>
</div>
<div class="paragraph">
<p><code>K3k</code> operates within the context of your currently configured kubectl context. This means that K3k respects the standard Kubernetes mechanisms for context configuration, including the <code>--kubeconfig</code> flag, the $KUBECONFIG environment variable, and the default $HOME/.kube/config file. Any K3k clusters you create will reside within the Kubernetes cluster that your kubectl is currently pointing to.</p>
</div>
<div class="sect2">
<h3 id="_creating_a_k3k_cluster"><a class="anchor" href="#_creating_a_k3k_cluster"></a>Creating a K3k Cluster</h3>
<div class="paragraph">
<p>To create a new K3k cluster, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">k3kcli cluster create mycluster</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Creating a K3k Cluster on a Rancher-Managed Host Cluster</strong></p>
</div>
<div class="paragraph">
<p>If your host Kubernetes cluster is managed by Rancher (for example, your kubeconfig&#8217;s server address includes a Rancher URL), use the <code>--kubeconfig-server</code> flag when creating your K3k cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">k3kcli cluster create --kubeconfig-server &lt;host_node_IP_or_load_balancer_IP&gt; mycluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>This ensures the generated kubeconfig connects to the correct endpoint.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the K3s server is ready, <code>k3kcli</code> will generate the necessary kubeconfig file and print instructions on how to use it.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">INFO[0000] Creating a new cluster [mycluster]
INFO[0000] Extracting Kubeconfig for [mycluster] cluster
INFO[0000] waiting for cluster to be available..
INFO[0073] certificate CN=system:admin,O=system:masters signed by CN=k3s-client-ca@1738746570: notBefore=2025-02-05 09:09:30 +0000 UTC notAfter=2026-02-05 09:10:42 +0000 UTC
INFO[0073] You can start using the cluster with:

        export KUBECONFIG=/my/current/directory/mycluster-kubeconfig.yaml
        kubectl cluster-info</code></pre>
</div>
</div>
<div class="paragraph">
<p>After exporting the generated kubeconfig, you can reach your Kubernetes cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export KUBECONFIG=/my/current/directory/mycluster-kubeconfig.yaml
kubectl get nodes
kubectl get pods -A</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also directly create a Cluster resource in some namespace, to create a K3k cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -f - &lt;&lt;EOF
apiVersion: k3k.io/v1alpha1
kind: Cluster
metadata:
  name: mycluster
  namespace: k3k-mycluster
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>and use the <code>k3kcli</code> to retrieve the kubeconfig:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">k3kcli kubeconfig generate --namespace k3k-mycluster --name mycluster</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deleting_a_k3k_cluster"><a class="anchor" href="#_deleting_a_k3k_cluster"></a>Deleting a K3k Cluster</h3>
<div class="paragraph">
<p>To delete a K3k cluster, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">k3kcli cluster delete mycluster</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architecture"><a class="anchor" href="#_architecture"></a>Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For an explanation of the <code>K3k</code> architecture, refer to the <a href="architecture.html" class="xref page">Architecture documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_usage"><a class="anchor" href="#_advanced_usage"></a>Advanced Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For in-depth examples and information on advanced K3k usage, including details on the differences between shared and virtual modes, resource management, and other configuration options, refer to the <a href="advanced-usage.html" class="xref page">Advanced Usage</a> documentation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_development"><a class="anchor" href="#_development"></a>Development</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you&#8217;re interested in building K3k from source or contributing to the project, refer to the <a href="development.html" class="xref page">Development documentation</a>.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="introduction.html">Introduction</a></span>
  <span class="next"><a href="architecture.html">Architecture</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
<script src="../../../_/js/vendor/langSelection.js"></script>
<script async src="../../../_/js/vendor/tabs.js"></script>


<script src="../../../_/js/CNLanguageSwitcher.js"></script>
  </body>
</html>
